#!/bin/bash
#
# usage: udge-update-all-problem-htmls [force]
prefix="$(dirname "$(dirname "$0")")"
. "$prefix/lib/udge/core"
force=$1
bn=`basename $0`

doit() {
	$what &&
		echo "$bn: $@" ||
		echo "$bn: problem updating $dst from $src"
}

markdown-() {
	$lib/markdown "$src" > "$dst"
}

cp-() {
	cp "$src" "$dst"
}

update() {
	src="$PROBLEMS/$1"
	dst="$PUBLIC_HTML/$2"
	[ ! -e "$dst" ]       && doit "created $dst from $src"
	[ "$dst" -ot "$src" ] && doit "updated $dst from $src (outdated)"
	[ "$force" = force ]  && doit "updated $dst from $src (force)"
	true
}

mkdir -p $PUBLIC_HTML
what=markdown- update index.md index.html
what=markdown- update 404.md   404.html
for problem in `ls-problems`
do
	what=markdown- update $problem/desc $problem.html
done
for asset in $PROBLEMS/*.{svg,png}
do
	[ -e "$asset" ] || continue
	name=`basename $asset`
	what=cp- update $name $name
done
